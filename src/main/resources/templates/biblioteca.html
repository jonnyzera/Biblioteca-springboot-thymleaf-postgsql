<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">

<head>
    <meta charset="UTF-8">
    <title>Sistema Biblioteca</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .logout-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>

<body class="container mt-4">

    <h1 class="mb-4">üìö Sistema Biblioteca</h1>
    <!-- <a th:href="@{/logout}" class="btn btn-danger logout-btn">Sair</a>
    <p>Voc√™ est√° logado como: <span th:text="${#authentication.name}"></span></p>
    <p>Seu perfil √©: <span th:text="${userRole}"></span></p>
    -->
    <div sec:authorize="hasRole('BIBLIOTECARIO')">
        <h2 class="mt-5">Se√ß√£o do Bibliotec√°rio</h2>

        <div class="card mb-4">
            <div class="card-header">Cadastrar Livro</div>
            <div class="card-body">
                <form th:action="@{/biblioteca/livro/salvar}" method="post">
                    <div class="row">
                        <div class="col-md-5">
                            <input type="text" name="titulo" placeholder="T√≠tulo" class="form-control" required>
                        </div>
                        <div class="col-md-5">
                            <input type="text" name="autor" placeholder="Autor" class="form-control" required>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-success w-100" type="submit">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">Cadastrar Usu√°rio</div>
            <div class="card-body">
                <form th:action="@{/biblioteca/usuario/salvar-usuario}" method="post">
                    <div class="row">
                        <div class="col-md-5">
                            <input type="text" name="nome" placeholder="Nome" class="form-control" required>
                        </div>
                        <div class="col-md-5">
                            <input type="email" name="email" placeholder="Email" class="form-control" required>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" type="submit">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <h2 class="mt-5">Se√ß√£o do Usu√°rio</h2>

    <div class="card mb-4">
        <div class="card-header">Livros Dispon√≠veis</div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>T√≠tulo</th>
                        <th>Autor</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="livro : ${livros}">
                        <td th:text="${livro.titulo}">T√≠tulo</td>
                        <td th:text="${livro.autor}">Autor</td>
                        <td>
                            <span th:text="${livro.disponivel} ? 'Dispon√≠vel' : 'Emprestado'"></span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card mb-4" sec:authorize="hasRole('USUARIO')">
        <div class="card-header">Criar Empr√©stimo</div>
        <div class="card-body">
            <form th:action="@{/biblioteca/emprestimo/emprestar}" method="post">
                <div class="row">
                    <div class="col-md-5">
                        <select name="usuarioId" class="form-control" required>
                            <option value="">-- Selecione Usu√°rio --</option>
                            <option th:each="u : ${usuarios}" th:value="${u.id}" th:text="${u.nome}"></option>
                        </select>
                    </div>
                    <div class="col-md-5">
                        <select name="livroId" class="form-control" required>
                            <option value="">-- Selecione Livro --</option>
                            <option th:each="l : ${livros}" th:value="${l.id}" th:text="${l.titulo}"
                                th:if="${l.disponivel}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-warning w-100" type="submit">Emprestar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="card mb-4" sec:authorize="hasAnyRole('USUARIO', 'BIBLIOTECARIO')">
        <div class="card-header">Empr√©stimos</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Livro</th>
                        <th>Usu√°rio</th>
                        <th>Data Empr√©stimo</th>
                        <th>Data Devolu√ß√£o</th>
                        <th>Dias Restantes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="e : ${emprestimos}">
                        <td th:text="${e.livro.titulo}">Livro</td>
                        <td th:text="${e.usuario.nome}">Usu√°rio</td>
                        <td th:text="${#temporals.format(e.dataEmprestimo, 'dd/MM/yyyy')}">01/01/2025</td>
                        <td th:text="${#temporals.format(e.dataDevolucao, 'dd/MM/yyyy')}">10/01/2025</td>
                        <td th:text="${e.diasRestantes}">5</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</body>

</html>